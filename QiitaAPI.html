<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QiitaAPI</title>
  <link rel="stylesheet" type="text/css" href="css/reset.css" />
  <link rel="stylesheet" type="text/css" href="css/sanitize.css" />
  <link rel="stylesheet" href="css/styles.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <script>
    $(function () {
      var no = 1;
      var num = 1;

      //ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹ã«ã™ã‚‹
      $.ajaxSetup({
        cahe: false
      });
      let arry = [];
      let obj;
      let a;
      let r, t;
      let u;
      let saveArticle = function () {
        $.get('http://qiita.com/api/v2/items?',
          { page: num, per_page: "1" }
        ).done(function (data) {
          $.each(data, function (i, v) {
            a = $("<a>").attr("href", v.url).text(`${num}-` + v.title);
            //liã‚¿ã‚°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã£ã¦å…ˆã»ã©ä½œã£ãŸaã‚’append
            $("#js_save_area").append($(`<li>`).append(a));
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã§ç„¡ç†ã‚„ã‚Šå¤–ã«å‡ºã™
            r = v.url;
            t = v.title;
          })
        });
      };


      // ä»Šã¾ã§ä¿å­˜ã—ãŸã“ã¨ãŒã‚ã‚‹å€‹æ•°ã‚’è¨˜æ†¶//
      let number = 0;
      if (localStorage.getItem('number')) {
        number = localStorage.getItem('number');
      }
      /////////////////////////////


      // ãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨å¤‰æ•°ã«æ ¼ç´
      $("#like").on('click', function () {
        u = { url: r, title: t };
        obj = u;
        let f = Number(number);
        a = $("<a>").attr("href", r).text(`${f + 1}-` + t);  //numberã¯stringå‹
        $("#choised_article").append($(`<li>`).attr('id', f + 1).append(a));
        const jsonData = JSON.stringify(obj);
        localStorage.setItem(number, jsonData);
        number++;
        setItems(number);
      });

      let setItems = (numbers) => {
        localStorage.setItem("number", numbers);
      }
      setItems(number);
      // ç¾åœ¨è‡ªåˆ†ãŒä½•å€‹ç›®ã®è¨˜äº‹ã‚’æ‰±ã£ã¦ã„ã‚‹ã‹åŸºæº–ã¨ã™ã‚‹ç‰©ã‚’LocalStorageã«ä¿å­˜
      let k = 1;
      // kiziã¯å…¨ã¦åˆã‚ã›ã¦500è¨˜äº‹ã¾ã§æ“ä½œå¯èƒ½
      let kizi = 500;
      for (let j = 0; j < kizi; j++) {
        if (localStorage.getItem(j)) {
          const jsonData = localStorage.getItem(j);
          arry = JSON.parse(jsonData);
          console.log('A', arry.url);
          // JSONã®ä¸­ã®é…åˆ—ã‚’è¡¨ç¤º
          const a = $("<a>").attr("href", arry.url).text(`${j + 1}-` + arry.title);
          $("#choised_article").append($(`<li>`).attr('id', j + 1).append(a));
          k++;
        }
      }

      let check1 = () => {
        if (num <= 1) {
          $("#prev").prop('disabled', true);
        } else {
          $("#prev").prop('disabled', false);
        }
      }

      let check10 = () => {
        if (num < 10) {
          $("#prev_10").prop('disabled', true);
          console.log(num);
        } else {
          $("#prev_10").prop('disabled', false);
        }
      }
      // 10è¨˜äº‹æˆ»ã‚‹ãƒœã‚¿ãƒ³
      $("#prev_10").click(function () {
        $("#js_save_area").children().hide();
        num -= 10;
        saveArticle();
        check1();
        check10();
      });

      // 1è¨˜äº‹æˆ»ã‚‹ãƒœã‚¿ãƒ³
      $("#prev").click(function () {
        $("#js_save_area").children().hide();
        num--;
        saveArticle();
        check1();
        check10();
      });
      // 1è¨˜äº‹é€²ã‚€ãƒœã‚¿ãƒ³
      $("#next").click(function () {
        $("#js_save_area").children().hide();
        num++;
        console.log(num);
        saveArticle();
        check1();
        check10();
      });
      // 10è¨˜äº‹é€²ã‚€ãƒœã‚¿ãƒ³
      $("#next_10").click(function () {
        $("#js_save_area").children().hide();
        num += 10;
        saveArticle();
        check1();
        check10();
      });

      //ç•ªå·ã‚’å…¥ã‚Œã¦ã‚µãƒ¼ãƒãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨localStorageã¨ãã®ç•ªå·ã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹
      let e;
      $("#article_search").click(function () {
        e = $('#article_number').val();
        console.log('e', e);
        $("#js_save_area").children().hide();
        num = e;
        saveArticle();
        check1();
        check10();
      });

      // locaStorageã¨ãŠæ°—ã«å…¥ã‚Šãƒªã‚¹ãƒˆã‚’å…¨ã¦æ¶ˆã™
      $("#clear").click(function () {
        if (confirm('å…¨ã¦æ¶ˆã—ã¾ã™ã‹ï¼Ÿ') == true) {
          for (let l = 0; l < kizi; l++) {

            if (localStorage.getItem(l)) {
              localStorage.removeItem(l);
              $("#choised_article").children(`#${l + 1}`).hide();
            }
          }
          number = 0;
          setItems(number);
        }
      });


      //ç•ªå·ã‚’å…¥ã‚Œã¦å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨localStorageã¨ãã®ç•ªå·ã®ãƒªã‚¹ãƒˆã‚’æ¶ˆã™      
      let d;
      $("#deleat").click(function () {
        d = $('#number').val();
        $("#choised_article").children(`#${d}`).hide();
        localStorage.removeItem(d - 1);
        $('#number').val("");
      });
      //ç•ªå·ã‚’å…¥ã‚Œã¦å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨localStorageã¨ãã®ç•ªå·ã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹
      $("#search").click(function () {
        d = $('#number').val();
        console.log('d', d);
        const a = $("<a>").attr("href", arry.url).text(`${d}-` + arry.title);
        $("#searched_article").append($(`<li>`).attr('id', d).append(a));
        $('#number').val("");
      });

      let m = 0;
      // // 20ä»¶ã¥ã¤è¡¨ç¤ºã™ã‚‹é–¢æ•°
      var getArticle = function () {
        $.get('http://qiita.com/api/v2/items?',
          { page: no, per_page: "20" }
        ).done(function (data) {
          $.each(data, function (i, v) {
            //aã‚¿ã‚°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã£ã¦hrefã«v.valã‚’ã‚»ãƒƒãƒˆ
            //v.titleã¯ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã§è¡¨ç¤º
            const a = $("<a>").attr("href", v.url).text(`${m + i + 1}-` + v.title);
            //liã‚¿ã‚°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã£ã¦å…ˆã»ã©ä½œã£ãŸaã‚’append
            //ãã‚Œã‚’#js_append_areaã«è¿½åŠ 
            $("#js_append_area").append($(`<li>`).append(a));
          })
          m += 20;
        });
      }

      // è¨˜äº‹ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®é–¢æ•°å‘¼ã³å‡ºã—
      saveArticle();

      // //æœ€åˆã®20ä»¶ã‚’è¡¨ç¤º
      getArticle();
      //ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã”ã¨ã«æ¬¡ã®20ä»¶ã‚’è¡¨ç¤º
      $('#next_20').click(function () {
        ++no;
        getArticle();
      });
    });
  </script>
</head>


<body>
  <div>è¡¨ç¤ºã—ãŸã„è¨˜äº‹ã®ç•ªå·ã‚’å…¥ã‚Œã¦ğŸ•µï¸â€â™€ï¸ã‚’æŠ¼ã—ã¦ãã ã•ã„</div>
  <main>
    ãƒœã‚¿ãƒ³ã‚’æ“ä½œã—ã¦è¨˜äº‹ç•ªå·ã‚’åˆã‚ã›ã¦ãã ã•ã„<br>
    <button id="prev_10" class="btn-denim">10å€‹æˆ»ã‚‹</button>
    <button id="prev" class="btn-denim">æˆ»ã‚‹</button>
    <button id="next" class="btn-denim">é€²ã‚€</button>
    <button id="next_10" class="btn-denim">10å€‹é€²ã‚€</button>
    <input type="text" id="article_number" class="number_area" placeholder="è¨˜äº‹ã®ç•ªå·">
    <button id="article_search" class="btn-denim">ğŸ•µï¸â€â™€ï¸[search]</button>
    <div id="js_save_area">
    </div>
    â†‘ã®è¨˜äº‹ã‚’ä¿å­˜ã™ã‚‹ã¨ãã¯ï¼ŒãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„â†’
    <button id="like" class="btn-denim">ãŠæ°—ã«å…¥ã‚Š</button>
  </main>

  <p>ä¿å­˜ã—ãŸãƒªã‚¹ãƒˆ</p>

  <ul id="searched_article"></ul>
  <div>æ¶ˆã—ãŸã„è¨˜äº‹ã®ç•ªå·ã‚’å…¥ã‚Œã¦å‰Šé™¤ã‚’æŠ¼ã—ã¦ãã ã•ã„
    <ul id="choised_article">
      <input type="text" id="number" class="number_area" placeholder="è¨˜äº‹ã®ç•ªå·">
      <button id="search" class="btn-denim">ğŸ•µï¸â€â™€ï¸[search]</button>
      <button id="deleat" class="btn-denim">[å‰Šé™¤]</button>
      <button id="clear" class="btn-denim">[Clear]</button>
  </div>


  <div>ä¸‹ã«20ä»¶ã¥ã¤è¨˜äº‹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
  <ul id="js_append_area"></ul>
  <a href="#" id="next_20">æ¬¡ã®20ä»¶ã‚’è¡¨ç¤º</a>


  </ul>
</body>

</html>